# thales-markets/contracts/scripts/

Deployment scripts instructions for Thales contracts.

## Process Overview

### 1. Deploying VestingEscrow contract

The first step is to run historical SNX stakers script with following command:

```bash
node scripts/snx-data/historical_snx.js
```

This script will generate JSON file - [`historical_snx.json`](./snx-data/historical_snx.json), which will be the input for `VestingEscrow` deployment script - [`historical_token_distribution.js`](./deployRetroLinearUnlock/historical_token_distribution.js):
```bash
npx hardhat run --network ropsten scripts/deployRetroLinearUnlock/historical_token_distribution.js
```

Deployment scripts will also update [`deployments.json`](./deployments.json) file with addresses of deployed contracts.

### 2. Deploying Airdrop contract

The file [`historical_snx.json`](./snx-data/historical_snx.json) is also input for `Airdrop` contract deployment script, run with following command:
```bash
npx hardhat run --network ropsten scripts/airdrop/deploy_airdrop.js
```
Deployment script will generate [`airdrop-hashes.json`](./airdrop/airdrop-hashes.json).


### 3. Deploying OngoingAirdrop and EscrowThales contract

Input for the deployment script is [`ongoing_distribution.json`](./snx-data/ongoing_distribution.json) which is generated by  [`ongoing_distribution.js`](./snx-data/ongoing_distribution.js):
```bash
node scripts/snx-data/ongoing_distribution.js start_date end_date
```
Arguments (`start_date`, `end_date`) are in format `yyyy-mm-dd` and also represent one week period (ideally Wednesday to Wednesday - to include the last two Synthetix `FeePeriodClosed` events).

Run initial deployment script with following command: 
```bash
npx hardhat run --network ropsten scripts/deployOngoingRewards/deployOngoingAirdrop.js
```
The script will also deploy the `EscrowThales` contract and generate file [`ongoing-airdrop-hashes-period-1.json`](./deployOngoingRewards/ongoing-airdrop-hashes-period-1.json) - which will also be the input for OngoingAirdrop maintenance script.

### 4. OngoingAirdrop maintenance

First, run [`ongoing_distribution.js`](./snx-data/ongoing_distribution.js) for the appropriate period: 
```bash
node scripts/snx-data/ongoing_distribution.js start_date end_date
```
Inputs for OngoingAirdrop maintenance script are [`ongoing_distribution.json`](./snx-data/ongoing_distribution.json) - generated by the previous command and `ongoing-airdrop-hashes-period-PERIOD.json` - generated in the last maintenance cycle. 

Run the maintenance script with following command:  
```bash
npx hardhat run --network ropsten scripts/deployOngoingRewards/ongoingAirdrop.js
```
The script will generate `ongoing-airdrop-hashes-period-(PERIOD+1).json`, input for the next maintenance cycle.

### 5. StakingThales contract

Run StakingThales deployment script with the following command: 
```bash
npx hardhat run --network ropsten scripts/deployStaking/deploy.js
```
The script enables the staking process from the beginning (runs `startStaking()` on deployment).